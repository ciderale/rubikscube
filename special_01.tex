\tikzset{top/.style={fill=green}}
\tikzset{bottom/.style={fill=blue}}
\tikzset{right/.style={fill=red}}
\tikzset{left/.style={fill=orange}}
\tikzset{front/.style={fill=yellow}}
\tikzset{back/.style={fill=white}}


\begin{tikzpicture}
  \tikzset{ultrathick/.style={line width=2}}
  \tikzset{arrowlabel/.style={pos=0.75,draw=black,fill=white,circle,inner sep=0.5pt,font=\sffamily\bfseries}}

  \newcommand{\base}[1]{
  \begin{scope}[z={(-0.5cm,+0.5cm)}]
    \drawCubicleNorthWest[X]{+1}{+1}{2}
    \drawCubicleNorthWest[X]{+0}{+1}{2}
    \drawCubicleNorthWest[X]{-1}{-1}{2}
    \drawCubicleNorthWest[X]{-1}{+0}{2}
    \drawCubicleNorthWest[X]{-1}{+1}{2}
    %
    \drawCubicleNorthWest[X]{-1}{-1}{1}
    \drawCubicleNorthWest[X]{-1}{-0}{1}
    \drawCubicleNorthWest[X]{+1}{+1}{1}
    \drawCubicleNorthWest[X]{+0}{+1}{1}
    \drawCubicleNorthWest[X]{-1}{+1}{1}
    %
    \drawCubicleNorthWest[X]{-0}{-1}{0}
    \drawCubicleNorthWest[X]{+1}{-0}{0}
    \drawCubicleNorthWest[_]{+1}{+1}{0}
    \drawCubicleNorthWest[X]{+0}{+0}{0}
    {#1
    \drawCubicleNorthWest[X]{-1}{+0}{0}
    }
    \drawCubicleNorthWest[X]{-0}{+1}{0}
    \begin{scope}[canvas is xz plane at y=2]
      \draw[very thick] (0,0) rectangle ++(1,2)
        node[midway,rotate=-45,fill=white,rounded corners,inner sep=1]{\bf\sffamily match};
    \end{scope}
  \end{scope}%
  \begin{scope}[z={(+0.5cm,-0.5cm)}]
    %% BACK
    \drawCubicleSouthEast[X]{-1}{-1}{2}
    \drawCubicleSouthEast[X]{-0}{-0}{2}
    \drawCubicleSouthEast[X]{+1}{+1}{2}
    %
    \drawCubicleSouthEast[X]{+0}{-1}{2}
    \drawCubicleSouthEast[X]{+1}{-0}{2}
    %
    {
      \tikzset{bottom/.style={pattern=horizontal lines}}
      \tikzset{right/.style={pattern=vertical lines}}
      \drawCubicleSouthEast[X]{+1}{-1}{2}
      \draw (2,-1,2) node[below=1,inner sep=1,fill=white,opacity=0.8]{\bf\sffamily dirty};
    }

    %% MIDDLE
    \drawCubicleSouthEast[X]{-1}{-1}{1}
    \drawCubicleSouthEast[X]{-0}{-0}{1}
    \drawCubicleSouthEast[X]{+1}{+1}{1}
    %
    \drawCubicleSouthEast[X]{+0}{-1}{1}
    \drawCubicleSouthEast[X]{+1}{-0}{1}
    %
    \drawCubicleSouthEast[X]{+1}{-1}{1}

    %% FRONT
    \drawCubicleSouthEast[X]{-1}{-0}{0}
    \drawCubicleSouthEast[X]{-0}{+1}{0}
    %
    \drawCubicleSouthEast[_]{-1}{-1}{0}
    \drawCubicleSouthEast[X]{+0}{-0}{0}
    \drawCubicleSouthEast[_]{+1}{+1}{0}
    %
    {#1
    \drawCubicleSouthEast[X]{-0}{-1}{0}
    }
    {#1
    \drawCubicleSouthEast[X]{+1}{-0}{0}
    }
    %
    \drawCubicleSouthEast[_]{+1}{-1}{0}
  \end{scope}%
}


\begin{scope}[xshift=0cm]
  \tikzset{back/.style={fill=green}}
  \tikzset{front/.style={fill=blue}}
  \tikzset{right/.style={fill=red}}
  \tikzset{left/.style={fill=orange}}
  \tikzset{top/.style={fill=yellow}}
  \tikzset{bottom/.style={fill=white}}

  \input{special_base}
\end{scope}



\tikzset{rotarrow/.style={->, shorten >=4, shorten <=4, line width=2}}
\tikzset{movarrow/.style={->, line width=2}}
\begin{scope}[xshift=-5cm]
  \base{
    \tikzset{left/.style={fill=red}}
    \tikzset{bottom/.style={fill=orange}}
    \tikzset{right/.style={fill=blue}}
  }
  \path (-0.5,0.5) coordinate (x);
  \draw[->,rotarrow] (x) -- ++(+2,0) coordinate(x) node[midway,above]{\bf clockwise};
  \draw[->,rotarrow] (x) -- ++(-1,-1) coordinate(x);
  \draw[->,rotarrow] (x) -- ++(-1,1) coordinate(x);

  \begin{scope}[xshift=1.5cm,yshift=+3.5cm,scale=2.0,local bounding box=BB]
  \path (0.1,0) coordinate (x);
    \draw[movarrow,>->] (x) -- ++(0,+0.9) coordinate(x) node[arrowlabel]{U};
    \draw[movarrow] (x) -- ++(+0.9,+0) coordinate(x) node[arrowlabel]{R};
    \draw[movarrow] (x) -- ++(0,-0.9) coordinate(x) node[arrowlabel]{D};
    \draw[movarrow] (x) -- ++(+0.9,0) coordinate(x) node[arrowlabel]{R};
    \draw[movarrow] (x) -- ++(0,+1.1) coordinate(x) node[arrowlabel]{U};
    \draw[movarrow] (x) -- ++(-2,0) coordinate(x) node[arrowlabel]{L};
    \draw[movarrow] (x) -- ++(0,-1.1) coordinate(x) node[arrowlabel]{D};
    \begin{pgfonlayer}{background}
      \fill[magenta,opacity=0.7] (BB.north west) rectangle (BB.south east);
    \end{pgfonlayer}
  \end{scope}

\end{scope}
\begin{scope}[xshift=+7cm]
  \base{
    \tikzset{left/.style={fill=blue}}
    \tikzset{bottom/.style={fill=red}}
    \tikzset{right/.style={fill=orange}}
  }
  \path (-0.5,0.5) coordinate (x);
  \draw[->,rotarrow] (x) -- ++(1,-1) coordinate(x);
  \draw[->,rotarrow] (x) -- ++(1,+1) coordinate(x);
  \draw[->,rotarrow] (x) -- ++(-2,0) coordinate(x) node[midway,above]{\bf counter-clockwise};

  \begin{scope}[xshift=-5cm,yshift=-4cm,scale=2.0,local bounding box=BB]
  \path (-0.1,0) coordinate (x);
    \draw[movarrow,>->] (x) -- ++(0,+1.1) coordinate(x) node[arrowlabel]{U};
    \draw[movarrow,movarrow] (x) -- ++(2,+0) coordinate(x) node[arrowlabel]{R};
    \draw[movarrow] (x) -- ++(0,-1.1) coordinate(x) node[arrowlabel]{D};
    \draw[movarrow] (x) -- ++(-0.9,0) coordinate(x) node[arrowlabel]{L};
    \draw[movarrow] (x) -- ++(-0,+0.9) coordinate(x) node[arrowlabel]{U};
    \draw[movarrow] (x) -- ++(-0.9,0) coordinate(x) node[arrowlabel]{L};
    \draw[movarrow] (x) -- ++(-0,-0.9) coordinate(x) node[arrowlabel]{D};
    \begin{pgfonlayer}{background}
      \fill[orange,opacity=0.7] (BB.north west) rectangle (BB.south east);
    \end{pgfonlayer}
  \end{scope}

\end{scope}
%\begin{scope}[xshift=7cm]
%  \base{
%    \tikzset{left/.style={fill=orange}}
%    \tikzset{bottom/.style={fill=blue}}
%    \tikzset{right/.style={fill=red}}
%  }
%\end{scope}

\end{tikzpicture}%
